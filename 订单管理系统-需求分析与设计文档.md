# 订单管理系统 - 需求分析与设计文档

## 1. 系统概述

### 1.1 项目背景
本订单管理系统基于Cool-Admin-Java框架开发，用于电子行业ERP系统的订单全流程管理，包括订单创建、审核、生产跟踪、发货、收款等完整业务流程。

### 1.2 技术架构
- **后端框架**: Spring Boot 3 + MyBatis-Flex
- **数据库**: MySQL/PostgreSQL
- **缓存**: Redis/Caffeine
- **开发模式**: 遵循Cool-Admin-Java项目规范

## 2. 功能模块划分

### 2.1 订单管理模块 (order)
- 订单创建与编辑
- 订单查询与列表
- 订单状态流转
- 订单审核流程
- 订单取消与删除

### 2.2 客户管理模块 (customer)
- 客户信息管理
- 客户分类管理
- 客户联系人管理
- 客户信用管理

### 2.3 产品管理模块 (product)
- 产品基础信息
- 产品分类管理
- 产品库存管理
- 产品价格管理

### 2.4 仓储管理模块 (warehouse)
- 仓库信息管理
- 库存管理
- 出入库记录
- 库存盘点

### 2.5 财务管理模块 (finance)
- 应收账款管理
- 收款记录
- 发票管理
- 财务报表

### 2.6 生产管理模块 (production)
- 生产计划
- 生产进度跟踪
- 生产工单管理

### 2.7 物流管理模块 (logistics)
- 发货管理
- 物流跟踪
- 签收管理

## 3. 数据库设计

### 3.1 核心实体关系

```
客户(Customer) 1----N 订单(Order)
订单(Order) 1----N 订单明细(OrderItem)
产品(Product) 1----N 订单明细(OrderItem)
订单(Order) 1----N 收款记录(PaymentRecord)
订单(Order) 1----1 发货单(Shipment)
发货单(Shipment) 1----N 物流记录(LogisticsRecord)
```

### 3.2 表结构设计

#### 3.2.1 订单主表 (erp_order)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| order_no | VARCHAR(50) | 订单编号 |
| customer_id | BIGINT | 客户ID |
| order_date | DATETIME | 订单日期 |
| delivery_date | DATETIME | 交货日期 |
| total_amount | DECIMAL(15,2) | 订单总金额 |
| paid_amount | DECIMAL(15,2) | 已付金额 |
| status | TINYINT | 订单状态 |
| remark | TEXT | 备注 |
| create_time | DATETIME | 创建时间 |
| update_time | DATETIME | 更新时间 |

#### 3.2.2 订单明细表 (erp_order_item)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| order_id | BIGINT | 订单ID |
| product_id | BIGINT | 产品ID |
| product_name | VARCHAR(200) | 产品名称 |
| product_code | VARCHAR(50) | 产品编码 |
| quantity | INT | 数量 |
| unit_price | DECIMAL(15,2) | 单价 |
| total_price | DECIMAL(15,2) | 小计 |
| remark | VARCHAR(500) | 备注 |

#### 3.2.3 客户表 (erp_customer)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| customer_code | VARCHAR(50) | 客户编码 |
| customer_name | VARCHAR(200) | 客户名称 |
| customer_type | TINYINT | 客户类型 |
| contact_person | VARCHAR(50) | 联系人 |
| contact_phone | VARCHAR(20) | 联系电话 |
| address | VARCHAR(500) | 地址 |
| credit_limit | DECIMAL(15,2) | 信用额度 |
| status | TINYINT | 状态 |

#### 3.2.4 产品表 (erp_product)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| product_code | VARCHAR(50) | 产品编码 |
| product_name | VARCHAR(200) | 产品名称 |
| category_id | BIGINT | 分类ID |
| specification | VARCHAR(200) | 规格型号 |
| unit | VARCHAR(20) | 单位 |
| price | DECIMAL(15,2) | 价格 |
| stock_quantity | INT | 库存数量 |
| status | TINYINT | 状态 |

#### 3.2.5 收款记录表 (erp_payment_record)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| order_id | BIGINT | 订单ID |
| payment_no | VARCHAR(50) | 收款单号 |
| payment_date | DATETIME | 收款日期 |
| payment_amount | DECIMAL(15,2) | 收款金额 |
| payment_method | TINYINT | 收款方式 |
| remark | VARCHAR(500) | 备注 |

#### 3.2.6 发货单表 (erp_shipment)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键ID |
| shipment_no | VARCHAR(50) | 发货单号 |
| order_id | BIGINT | 订单ID |
| shipment_date | DATETIME | 发货日期 |
| carrier | VARCHAR(100) | 承运商 |
| tracking_no | VARCHAR(100) | 物流单号 |
| status | TINYINT | 状态 |

## 4. 业务流程设计

### 4.1 订单处理流程
```
1. 创建订单 -> 2. 订单审核 -> 3. 生产计划 -> 4. 生产完成 -> 5. 发货 -> 6. 收款 -> 7. 订单完成
```

### 4.2 订单状态定义
- 0: 草稿
- 1: 待审核
- 2: 已审核
- 3: 生产中
- 4: 待发货
- 5: 已发货
- 6: 已完成
- 7: 已取消

### 4.3 权限控制
- 销售人员: 可创建、编辑订单
- 销售经理: 可审核订单
- 生产部门: 可查看已审核订单，更新生产状态
- 仓储部门: 可发货
- 财务部门: 可录入收款记录

## 5. 接口设计

### 5.1 订单管理接口
- POST /admin/erp/order/add - 创建订单
- POST /admin/erp/order/update - 更新订单
- POST /admin/erp/order/delete - 删除订单
- POST /admin/erp/order/page - 分页查询订单
- GET /admin/erp/order/info - 获取订单详情
- POST /admin/erp/order/audit - 审核订单
- POST /admin/erp/order/cancel - 取消订单

### 5.2 客户管理接口
- POST /admin/erp/customer/add - 创建客户
- POST /admin/erp/customer/update - 更新客户
- POST /admin/erp/customer/page - 分页查询客户
- GET /admin/erp/customer/info - 获取客户详情

### 5.3 产品管理接口
- POST /admin/erp/product/add - 创建产品
- POST /admin/erp/product/update - 更新产品
- POST /admin/erp/product/page - 分页查询产品
- GET /admin/erp/product/info - 获取产品详情

## 6. 非功能需求

### 6.1 性能要求
- 订单查询响应时间 < 500ms
- 支持并发用户数 >= 100
- 数据库查询优化，添加必要索引

### 6.2 安全要求
- 所有接口需要JWT认证
- 敏感数据加密存储
- 操作日志记录

### 6.3 可用性要求
- 系统可用性 >= 99%
- 数据备份策略
- 异常处理机制

## 7. 开发规范

### 7.1 代码规范
- 遵循Cool-Admin-Java项目规范
- Controller继承BaseController
- Service继承BaseService
- 使用@CoolRestController注解

### 7.2 命名规范
- 实体类: ErpXxxEntity
- Controller: AdminErpXxxController
- Service: ErpXxxService
- Mapper: ErpXxxMapper

### 7.3 模块组织
```
modules/
  └── erp/
      ├── order/       # 订单模块
      ├── customer/    # 客户模块
      ├── product/     # 产品模块
      ├── warehouse/   # 仓储模块
      ├── finance/     # 财务模块
      ├── production/  # 生产模块
      └── logistics/   # 物流模块
```

## 8. 实施计划

### 8.1 第一阶段（核心功能）
- 订单管理模块
- 客户管理模块
- 产品管理模块

### 8.2 第二阶段（扩展功能）
- 仓储管理模块
- 财务管理模块

### 8.3 第三阶段（高级功能）
- 生产管理模块
- 物流管理模块
- 报表统计模块
